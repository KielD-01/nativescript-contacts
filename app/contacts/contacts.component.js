"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var contacts_service_1 = require("./contacts.service");
var app_component_1 = require("../app.component");
var dialogs = require("ui/dialogs");
var firebase = require("nativescript-plugin-firebase");
var appSettings = require("application-settings");
var ContactsComponent = (function () {
    function ContactsComponent(app, cService) {
        this.app = app;
        this.cService = cService;
        this.contacts = [];
        this.fields = {
            first_name: 'First Name',
            last_name: 'Last Name',
            phone: 'Phone'
        };
        this.types = {
            asc: 'Ascending',
            desc: 'Descending',
        };
        this.sorting = {
            first_name: {
                asc: function (x, y) {
                    var a = x['first_name'].toLowerCase(), b = y['first_name'].toLowerCase();
                    if (a < b)
                        return -1;
                    if (a > b)
                        return 1;
                    return 0;
                },
                desc: function (x, y) {
                    var a = x['first_name'].toLowerCase(), b = y['first_name'].toLowerCase();
                    if (b < a)
                        return -1;
                    if (b > a)
                        return 1;
                    return 0;
                }
            },
            last_name: {
                asc: function (x, y) {
                    var a = x['last_name'].toLowerCase(), b = y['last_name'].toLowerCase();
                    if (a < b)
                        return -1;
                    if (a > b)
                        return 1;
                    return 0;
                },
                desc: function (x, y) {
                    var a = x['last_name'].toLowerCase(), b = y['last_name'].toLowerCase();
                    if (b < a)
                        return -1;
                    if (b > a)
                        return 1;
                    return 0;
                }
            },
            phone: {
                asc: function (x, y) {
                    var a = x['phone'].toLowerCase(), b = y['phone'].toLowerCase();
                    if (a < b)
                        return -1;
                    if (a > b)
                        return 1;
                    return 0;
                },
                desc: function (x, y) {
                    var a = x['phone'].toLowerCase(), b = y['phone'].toLowerCase();
                    if (b < a)
                        return -1;
                    if (b > a)
                        return 1;
                    return 0;
                }
            },
        };
        this.service = cService;
        this.orderBy = {
            field: 'first_name',
            type: 'asc'
        };
        this.contacts = this.service.getContacts(this.orderBy.field, this.orderBy.type);
    }
    ContactsComponent.prototype.ngOnInit = function () {
        this.reOrder();
    };
    ContactsComponent.prototype.reOrder = function () {
        this.contacts.sort(this.sorting[this.orderBy.field][this.orderBy.type]);
    };
    ContactsComponent.prototype.selectOrderField = function () {
        var _this = this;
        var component = this;
        dialogs.action({
            message: "Select Field to Order the Contacts",
            cancelButtonText: 'Cancel',
            actions: ['First Name', 'Last Name', 'Phone']
        })
            .then(function (result) {
            switch (result) {
                case 'First Name':
                    component.orderBy.field = 'first_name';
                    break;
                case 'Last Name':
                    component.orderBy.field = 'last_name';
                    break;
                case 'Phone':
                    component.orderBy.field = 'phone';
                    break;
            }
            _this.reOrder();
        });
    };
    ContactsComponent.prototype.selectOrderTypeField = function () {
        var _this = this;
        var component = this;
        dialogs.action({
            message: "Select Sorting Type",
            cancelButtonText: 'Cancel',
            actions: ['Ascending', 'Descending']
        })
            .then(function (result) {
            switch (result) {
                case 'Ascending':
                    component.orderBy.type = 'asc';
                    break;
                case 'Descending':
                    component.orderBy.type = 'desc';
                    break;
            }
            _this.reOrder();
        });
    };
    ContactsComponent = __decorate([
        core_1.Component({
            selector: 'my-app',
            templateUrl: './pages/contacts/list.html',
            providers: [contacts_service_1.ContactsService]
        }),
        __metadata("design:paramtypes", [app_component_1.AppComponent, contacts_service_1.ContactsService])
    ], ContactsComponent);
    return ContactsComponent;
}());
exports.ContactsComponent = ContactsComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGFjdHMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29udGFjdHMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWdEO0FBQ2hELHVEQUFtRDtBQUNuRCxrREFBOEM7QUFHOUMsb0NBQXFDO0FBRXJDLElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBQ3pELElBQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBUXBEO0lBaUZJLDJCQUFtQixHQUFpQixFQUFTLFFBQXlCO1FBQW5ELFFBQUcsR0FBSCxHQUFHLENBQWM7UUFBUyxhQUFRLEdBQVIsUUFBUSxDQUFpQjtRQS9FdEUsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUlkLFdBQU0sR0FBRztZQUNMLFVBQVUsRUFBRSxZQUFZO1lBQ3hCLFNBQVMsRUFBRSxXQUFXO1lBQ3RCLEtBQUssRUFBRSxPQUFPO1NBQ2pCLENBQUM7UUFFRixVQUFLLEdBQUc7WUFDSixHQUFHLEVBQUUsV0FBVztZQUNoQixJQUFJLEVBQUUsWUFBWTtTQUNyQixDQUFDO1FBRUYsWUFBTyxHQUFHO1lBQ04sVUFBVSxFQUFFO2dCQUNSLEdBQUcsRUFBRSxVQUFDLENBQUMsRUFBRSxDQUFDO29CQUNOLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxXQUFXLEVBQUUsRUFDakMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztvQkFFdEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQzt3QkFBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3JCLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztvQkFFcEIsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDYixDQUFDO2dCQUNE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QUNWLENBQUM7SUFFRCxnREFBb0IsR0FBcEI7UUFBQSxpQkFxQkM7UUFuQkcsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBRXJCLE9BQU8sQ0FBQyxNQUFNLENBQUM7WUFDWCxPQUFPLEVBQUUscUJBQXFCO1lBQzlCLGdCQUFnQixFQUFFLFFBQVE7WUFDMUIsT0FBTyxFQUFFLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQztTQUN2QyxDQUFDO2FBQ0csSUFBSSxDQUFDLFVBQUEsTUFBTTtZQUNSLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQ2IsS0FBSyxXQUFXO29CQUNaLFNBQVMsQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztvQkFDL0IsS0FBSyxDQUFDO2dCQUNWLEtBQUssWUFBWTtvQkFDYixTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksR0FBRyxNQUFNLENBQUM7b0JBQ2hDLEtBQUssQ0FBQztZQUNkLENBQUM7WUFFRCxLQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDbkIsQ0FBQyxDQUFDLENBQUE7SUFDVixDQUFDO0lBakpRLGlCQUFpQjtRQU43QixnQkFBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLFFBQVE7WUFDbEIsV0FBVyxFQUFFLDRCQUE0QjtZQUN6QyxTQUFTLEVBQUUsQ0FBQyxrQ0FBZSxDQUFDO1NBQy9CLENBQUM7eUNBbUYwQiw0QkFBWSxFQUFtQixrQ0FBZTtPQWpGN0QsaUJBQWlCLENBa0o3QjtJQUFELHdCQUFDO0NBQUEsQUFsSkQsSUFrSkM7QUFsSlksOENBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIE9uSW5pdH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7Q29udGFjdHNTZXJ2aWNlfSBmcm9tIFwiLi9jb250YWN0cy5zZXJ2aWNlXCI7XG5pbXBvcnQge0FwcENvbXBvbmVudH0gZnJvbSBcIi4uL2FwcC5jb21wb25lbnRcIjtcbmltcG9ydCB7S2V5Ym9hcmRUeXBlfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9lbnVtc1wiO1xuaW1wb3J0IG51bWJlciA9IEtleWJvYXJkVHlwZS5udW1iZXI7XG5pbXBvcnQgKiBhcyBkaWFsb2dzIGZyb20gXCJ1aS9kaWFsb2dzXCJcblxuY29uc3QgZmlyZWJhc2UgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXBsdWdpbi1maXJlYmFzZVwiKTtcbmNvbnN0IGFwcFNldHRpbmdzID0gcmVxdWlyZShcImFwcGxpY2F0aW9uLXNldHRpbmdzXCIpO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ215LWFwcCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3BhZ2VzL2NvbnRhY3RzL2xpc3QuaHRtbCcsXG4gICAgcHJvdmlkZXJzOiBbQ29udGFjdHNTZXJ2aWNlXVxufSlcblxuZXhwb3J0IGNsYXNzIENvbnRhY3RzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIGNvbnRhY3RzID0gW107XG4gICAgc2VydmljZTogQ29udGFjdHNTZXJ2aWNlO1xuICAgIHB1YmxpYyBvcmRlckJ5OiBhbnk7XG5cbiAgICBmaWVsZHMgPSB7XG4gICAgICAgIGZpcnN0X25hbWU6ICdGaXJzdCBOYW1lJyxcbiAgICAgICAgbGFzdF9uYW1lOiAnTGFzdCBOYW1lJyxcbiAgICAgICAgcGhvbmU6ICdQaG9uZSdcbiAgICB9O1xuXG4gICAgdHlwZXMgPSB7XG4gICAgICAgIGFzYzogJ0FzY2VuZGluZycsXG4gICAgICAgIGRlc2M6ICdEZXNjZW5kaW5nJyxcbiAgICB9O1xuXG4gICAgc29ydGluZyA9IHtcbiAgICAgICAgZmlyc3RfbmFtZToge1xuICAgICAgICAgICAgYXNjOiAoeCwgeSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBhID0geFsnZmlyc3RfbmFtZSddLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICAgIGIgPSB5WydmaXJzdF9uYW1lJ10udG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgICAgIGlmIChhIDwgYikgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgIGlmIChhID4gYikgcmV0dXJuIDE7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZXNjOiAoeCwgeSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBhID0geFsnZmlyc3RfbmFtZSddLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICAgIGIgPSB5WydmaXJzdF9uYW1lJ10udG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgICAgIGlmIChiIDwgYSkgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgIGlmIChiID4gYSkgcmV0dXJuIDE7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgbGFzdF9uYW1lOiB7XG4gICAgICAgICAgICBhc2M6ICh4LCB5KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGEgPSB4WydsYXN0X25hbWUnXS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgICAgICAgICBiID0geVsnbGFzdF9uYW1lJ10udG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgICAgIGlmIChhIDwgYikgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgIGlmIChhID4gYikgcmV0dXJuIDE7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZXNjOiAoeCwgeSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBhID0geFsnbGFzdF9uYW1lJ10udG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICAgICAgYiA9IHlbJ2xhc3RfbmFtZSddLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoYiA8IGEpIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICBpZiAoYiA+IGEpIHJldHVybiAxO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBob25lOiB7XG4gICAgICAgICAgICBhc2M6ICh4LCB5KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGEgPSB4WydwaG9uZSddLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICAgIGIgPSB5WydwaG9uZSddLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoYSA8IGIpIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICBpZiAoYSA+IGIpIHJldHVybiAxO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVzYzogKHgsIHkpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgYSA9IHhbJ3Bob25lJ10udG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICAgICAgYiA9IHlbJ3Bob25lJ10udG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgICAgIGlmIChiIDwgYSkgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgIGlmIChiID4gYSkgcmV0dXJuIDE7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICB9O1xuXG5cbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgYXBwOiBBcHBDb21wb25lbnQsIHB1YmxpYyBjU2VydmljZTogQ29udGFjdHNTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuc2VydmljZSA9IGNTZXJ2aWNlO1xuICAgICAgICB0aGlzLm9yZGVyQnkgPSB7XG4gICAgICAgICAgICBmaWVsZDogJ2ZpcnN0X25hbWUnLFxuICAgICAgICAgICAgdHlwZTogJ2FzYydcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jb250YWN0cyA9IHRoaXMuc2VydmljZS5nZXRDb250YWN0cyh0aGlzLm9yZGVyQnkuZmllbGQsIHRoaXMub3JkZXJCeS50eXBlKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAgICB0aGlzLnJlT3JkZXIoKTtcbiAgICB9XG5cbiAgICByZU9yZGVyKCkge1xuICAgICAgICB0aGlzLmNvbnRhY3RzLnNvcnQodGhpcy5zb3J0aW5nW3RoaXMub3JkZXJCeS5maWVsZF1bdGhpcy5vcmRlckJ5LnR5cGVdKTtcbiAgICB9XG5cbiAgICBzZWxlY3RPcmRlckZpZWxkKCkge1xuXG4gICAgICAgIGxldCBjb21wb25lbnQgPSB0aGlzO1xuXG4gICAgICAgIGRpYWxvZ3MuYWN0aW9uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiU2VsZWN0IEZpZWxkIHRvIE9yZGVyIHRoZSBDb250YWN0c1wiLFxuICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ0NhbmNlbCcsXG4gICAgICAgICAgICBhY3Rpb25zOiBbJ0ZpcnN0IE5hbWUnLCAnTGFzdCBOYW1lJywgJ1Bob25lJ11cbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnRmlyc3QgTmFtZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQub3JkZXJCeS5maWVsZCA9ICdmaXJzdF9uYW1lJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdMYXN0IE5hbWUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50Lm9yZGVyQnkuZmllbGQgPSAnbGFzdF9uYW1lJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdQaG9uZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQub3JkZXJCeS5maWVsZCA9ICdwaG9uZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLnJlT3JkZXIoKTtcbiAgICAgICAgICAgIH0pXG4gICAgfVxuXG4gICAgc2VsZWN0T3JkZXJUeXBlRmllbGQoKSB7XG5cbiAgICAgICAgbGV0IGNvbXBvbmVudCA9IHRoaXM7XG5cbiAgICAgICAgZGlhbG9ncy5hY3Rpb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogXCJTZWxlY3QgU29ydGluZyBUeXBlXCIsXG4gICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAnQ2FuY2VsJyxcbiAgICAgICAgICAgIGFjdGlvbnM6IFsnQXNjZW5kaW5nJywgJ0Rlc2NlbmRpbmcnXVxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdBc2NlbmRpbmcnOlxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50Lm9yZGVyQnkudHlwZSA9ICdhc2MnO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0Rlc2NlbmRpbmcnOlxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50Lm9yZGVyQnkudHlwZSA9ICdkZXNjJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMucmVPcmRlcigpO1xuICAgICAgICAgICAgfSlcbiAgICB9XG59Il19